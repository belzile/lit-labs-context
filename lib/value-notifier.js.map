{"version":3,"file":"value-notifier.js","sources":["../src/lib/value-notifier.ts"],"sourcesContent":["/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\nimport {ContextCallback} from './context-request-event.js';\n\n/**\n * A disposer function\n */\ntype Disposer = () => void;\n\n/**\n * A simple class which stores a value, and triggers registered callbacks when the\n * value is changed via its setter.\n *\n * An implementor might use other observable patterns such as MobX or Redux to get\n * behavior like this. But this is a pretty minimal approach that will likely work\n * for a number of use cases.\n */\nexport class ValueNotifier<T> {\n  private callbacks: Map<ContextCallback<T>, Disposer> = new Map();\n\n  private _value!: T;\n  public get value(): T {\n    return this._value;\n  }\n  public set value(v: T) {\n    this.setValue(v);\n  }\n\n  public setValue(v: T, force = false) {\n    let changed = false;\n    if (!Object.is(v, this._value)) {\n      changed = true;\n    }\n    this._value = v;\n    if (changed || force) {\n      this.updateObservers();\n    }\n  }\n\n  constructor(defaultValue?: T) {\n    if (defaultValue !== undefined) {\n      this.value = defaultValue;\n    }\n  }\n\n  updateObservers = (): void => {\n    for (const [callback, disposer] of this.callbacks) {\n      callback(this._value, disposer);\n    }\n  };\n\n  addCallback(callback: ContextCallback<T>, subscribe?: boolean): void {\n    if (subscribe) {\n      if (!this.callbacks.has(callback)) {\n        this.callbacks.set(callback, () => {\n          this.callbacks.delete(callback);\n        });\n      }\n    }\n    callback(this.value);\n  }\n\n  clearCallbacks(): void {\n    this.callbacks.clear();\n  }\n}\n"],"names":["ValueNotifier","constructor","defaultValue","this","Map","callback","disposer","callbacks","_value","undefined","value","v","setValue","force","changed","Object","is","updateObservers","addCallback","subscribe","has","set","delete","clearCallbacks","clear"],"mappings":";;;;;MAqBaA,EAsBXC,YAAYC,GArBJC,eAA+C,IAAIC,IA2B3DD,qBAAkB,KAChB,IAAK,MAAOE,EAAUC,KAAaH,KAAKI,UACtCF,EAASF,KAAKK,EAAQF,SAPHG,IAAjBP,IACFC,KAAKO,MAAQR,GApBNQ,YACT,OAAOP,KAAKK,EAEHE,UAAMC,GACfR,KAAKS,SAASD,GAGTC,SAASD,EAAME,GAAQ,GAC5B,IAAIC,GAAU,EACTC,OAAOC,GAAGL,EAAGR,KAAKK,KACrBM,GAAU,GAEZX,KAAKK,EAASG,GACVG,GAAWD,IACbV,KAAKc,kBAgBTC,YAAYb,EAA8Bc,GACpCA,IACGhB,KAAKI,UAAUa,IAAIf,IACtBF,KAAKI,UAAUc,IAAIhB,GAAU,KAC3BF,KAAKI,UAAUe,OAAOjB,OAI5BA,EAASF,KAAKO,OAGhBa,iBACEpB,KAAKI,UAAUiB"}